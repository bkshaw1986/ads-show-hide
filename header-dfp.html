<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ads Control with Cookie</title>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
  <h3>My Page with Ads</h3>

  <!-- Example ad containers -->
  <div id="ad1">Ad Slot 1</div>
  <div id="ad2">Ad Slot 2</div>
  <div id="ad3">Ad Slot 3</div>

  <script>
    // cookie helpers
    function setCookie(name, value, days) {
      var d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
    }

    function getCookie(name) {
      var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? match[2] : null;
    }

    // check cookie to decide ads visibility
    function canShowAds() {
      return getCookie("ads_disabled") !== "1";
    }

    $(function() {
      // If cookie already exists, skip API call
      if (getCookie("ads_disabled") !== null) {
        if (!canShowAds()) {
          $("#ad1, #ad2, #ad3").remove();
        } else {
          $("#ad1").text("Real Ad 1 loaded");
          $("#ad2").text("Real Ad 2 loaded");
          $("#ad3").text("Real Ad 3 loaded");
        }
        return;
      }

      // Call .pl only if cookie not set
      $.ajax({
        url: "https://dev.123greetings.com/cgi-bin/test/check_pro.pl",
        method: "GET",
        dataType: "json", 
	timeout: 5000,
        success: function(resp) {
          // assuming resp = 0 or 1
          if (resp == 1) {
            setCookie("ads_disabled", "1", 1);
            $("#ad1, #ad2, #ad3").remove();
          } else {
            setCookie("ads_disabled", "0", 1);
            $("#ad1").text("Real Ad 1 loaded");
            $("#ad2").text("Real Ad 2 loaded");
            $("#ad3").text("Real Ad 3 loaded");
          }
        },
        error: function() {
          // If API fails, better to disable ads
          setCookie("ads_disabled", "1", 1);
          $("#ad1, #ad2, #ad3").remove();
        }
      });
    });
  </script>
</body>
</html>
